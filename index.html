<!DOCTYPE html>
<html>
<head>
    <title>SlamData</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="bower_components/c3/c3.css">
    <link rel="stylesheet" type="text/css" href="bower_components/entypo/font/entypo.css" />
    <link rel="stylesheet" type="text/css" href="bower_components/fontawesome/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <script src="bower_components/c3/c3.js"></script>
    <script src="bower_components/d3/d3.js" charset="utf-8"></script>
    <script src="bower_components/modernizr/modernizr.js"></script>
    <script src="bower_components/node-uuid/uuid.js"></script>
    <script src="bower_components/oboe/dist/oboe-browser.js"></script>
    <script src="bower_components/showdown/src/showdown.js"></script>
</head>
<body>
    <div id="content"></div>

    <script src="bower_components/react/react-with-addons.js"></script>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/fastclick/lib/fastclick.js"></script>
    <script src="bower_components/foundation/js/foundation/foundation.js"></script>
    <script src="bower_components/foundation/js/foundation/foundation.topbar.js"></script>
    <script src="bower_components/tiny-emitter/dist/tinyemitter.js"></script>
    <script src="js/slamdata.js"></script>
    <script type="text/javascript">
        var helpers = PS.SlamData_Helpers;
        var jsTypes = PS.SlamData_Types_JS;
        var types = PS.SlamData_Types;
        // Load up slamdata.
        var state = {
            files: [],
            notebooks: [],
            settings: {
                sdConfig: helpers.defaultSDConfig,
                seConfig: helpers.defaultSEConfig
            }
        };
        // Start up an emitter to pass down to slamdata.
        var emitter = new TinyEmitter();
        var respond = function(data) {
            return emitter.emit(types.responseEvent, data);
        }
        emitter.on(types.requestEvent, function(request) {
            if (jsTypes.isReadFileSystem(request.event)) {
                var fs = helpers.serverURI(state.settings.sdConfig) + '/metadata/fs/'
                oboe(fs)
                    .done(function(files) {
                        var state = request.state;
                        state.files = files.children;
                        respond(state);
                    })
            } else {
                respond(state);
            }
        });
        PS.SlamData.slamData(emitter)(state)();
        // We have to initialize any foundation stuff last.
        $(document).foundation();
    </script>
</body>
</html>
